import{computed as e,inject as t}from"vue";import r from"axios";const s={all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map((function(e){e(t)})),(r=i.get("*"))&&r.slice().map((function(r){r(e,t)}))}};var i;const n={$on:(...e)=>s.on(...e),$once:(...e)=>s.once(...e),$off:(...e)=>s.off(...e),$emit:(...e)=>s.emit(...e)},o={props:["props","params","matestack-ui-vuejs-ref"],computed:{vc:function(){return this}},methods:{getRefs:function(){var e={},t=this.props.component_uid,r=this.getTemplateElement().querySelectorAll("[matestack-ui-vuejs-ref]");for(let s in r){let i=r[s];if(i.getAttribute){let r=i.getAttribute("matestack-ui-vuejs-ref");r.startsWith(t)&&(e[r.replace(t+"-","")]=i)}}return e},getTemplateElement:function(){return document.getElementById("uid-"+this.props.component_uid)},getElement:function(){return this.getTemplateElement().firstChild},registerEvents:function(e,t){null!=e&&e.split(",").forEach((e=>n.$on(e.trim(),t)))},removeEvents:function(e,t){null!=e&&e.split(",").forEach((e=>n.$off(e.trim(),t)))},emitScopedEvent:function(e,t={}){n.$emit(this.props.component_uid+"_"+e,t)},registerScopedEvent:function(e,t,r=this.props.component_uid){n.$on(r+"_"+e,t)},removeScopedEvent:function(e,t,r=this.props.component_uid){n.$off(r+"_"+e,t)},getXcsrfToken:function(){if(document.getElementsByName("csrf-token")[0])return document.getElementsByName("csrf-token")[0].getAttribute("content")}}},a={inlineTemplate:'<slot :vc="vc"></slot>'},p={mixins:[o],template:a.inlineTemplate,props:["appConfig","params"],data:function(){return{pageTemplate:null,pageLoading:!1,currentPathName:document.location.pathname,currentSearch:document.location.search,currentOrigin:document.location.origin}},provide:function(){return{pageTemplate:e((()=>this.pageTemplate)),pageLoading:e((()=>this.pageLoading)),currentPathName:e((()=>this.currentPathName)),currentSearch:e((()=>this.currentSearch)),currentOrigin:e((()=>this.currentOrigin)),appNavigateTo:this.navigateTo,setPageLoading:this.setPageLoading}},mounted:function(){const e=this;window.addEventListener("popstate",(t=>{this.isNavigatingToAnotherPage({origin:e.currentOrigin,pathName:e.currentPathName,search:e.currentSearch},document.location)&&(n.$emit("page_loading_triggered",document.location.pathname+document.location.search),e.pageLoading=!0,e.navigateTo({url:document.location.pathname+document.location.search,backwards:!0}))}))},methods:{navigateTo({url:e,backwards:t}){const s=this;if(s.pageLoading=!0,n.$emit("page_loading",e),window.history.pushState)return new Promise(((i,o)=>{r({method:"get",url:e,headers:{"X-CSRF-Token":s.getXcsrfToken()},params:{only_page:!0}}).then((function(r){t?window.history.replaceState({matestackApp:!0,url:e},null,e):window.history.pushState({matestackApp:!0,url:e},null,e),setTimeout((function(){i(r.data),s.pageTemplate=r.data,s.setCurrentLocation({path:e.split("?")[0],search:document.location.search,origin:document.location.origin}),s.pageLoading=!1,s.pageScrollTop(),n.$emit("page_loaded",e)}),5)})).catch((function(e){setTimeout((function(){i(e),n.$emit("page_loading_error",e)}),5)}))}));document.location.href=e},setPageLoading(e){this.pageLoading=e},setCurrentLocation(e){this.currentPathName=e.path,this.currentSearch=e.search,this.currentOrigin=e.origin},pageScrollTop(){const e=function(t){return null==t?null:t.scrollHeight>t.clientHeight?t:e(t.parentNode)};var t=e(document.getElementsByClassName("matestack-page-root")[0]);t&&(t.scrollTop=0)},isNavigatingToAnotherPage:(e,t)=>e.pathName!==t.pathname||e.origin!==t.origin||e.search!==t.search}},l={mixins:[o],template:a.inlineTemplate,data:function(){return{}},inject:["pageTemplate","pageLoading"],computed:{asyncPageTemplate:function(){return this.pageTemplate},loading:function(){return this.pageLoading}}},u={template:'<component :is="dynamicComponent" :vc="vc" :template="template" />',props:["vc","template"],computed:{dynamicComponent:function(){return{props:["vc","template"],template:`${this.template||"<div></div>"}`}}}};var m=(e,t,r)=>{r||(r=window.location.href);let s,i=new RegExp(`([?&])${e}=.*?(&|#|$)(.*)`,"gi");if(i.test(r))return null!=t?r.replace(i,`$1${e}=${t}$2$3`):(s=r.split("#"),r=s[0].replace(i,"$1$3").replace(/(&|\?)$/,""),void 0!==s[1]&&null!==s[1]&&(r+=`#${s[1]}`),r);if(null!=t){const i=-1!==r.indexOf("?")?"&":"?";return s=r.split("#"),r=`${s[0]}${i}${e}=${t}`,void 0!==s[1]&&null!==s[1]&&(r+=`#${s[1]}`),r}return r},c=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},d=()=>{const e=window.location.search.substring(1);if(0===e.length)return{};return JSON.parse(`{"${e.replace(/&/g,'","').replace(/=/g,'":"')}"}`,((e,t)=>""===e?t:decodeURIComponent(t)))};const h={mixins:[o],template:a.inlineTemplate,data:function(){return{currentLimit:null,currentOffset:null,currentFilteredCount:null,currentBaseCount:null}},methods:{next:function(){if(this.currentTo()<this.currentCount()){this.currentOffset+=this.currentLimit;var e=m(this.props.id+"-offset",this.currentOffset);window.history.pushState({matestackApp:!0,url:e},null,e),n.$emit(this.props.id+"-update")}},previous:function(){if(-1*(this.currentOffset-this.currentLimit)!=this.currentLimit){this.currentOffset-this.currentLimit<0?this.currentOffset=0:this.currentOffset-=this.currentLimit;var e=m(this.props.id+"-offset",this.currentOffset);window.history.pushState({matestackApp:!0,url:e},null,e),n.$emit(this.props.id+"-update")}},currentTo:function(){var e=parseInt(this.currentOffset)+parseInt(this.currentLimit);return e>parseInt(this.currentCount())?this.currentCount():e},currentCount:function(){return null!=this.currentFilteredCount||null!=this.currentFilteredCount?this.currentFilteredCount:this.currentBaseCount},goToPage:function(e){this.currentOffset=parseInt(this.currentLimit)*(parseInt(e)-1);var t=m(this.props.id+"-offset",this.currentOffset);window.history.pushState({matestackApp:!0,url:t},null,t),n.$emit(this.props.id+"-update")}},mounted:function(){null!=c(this.props.id+"-offset")?this.currentOffset=parseInt(c(this.props.id+"-offset")):null!=this.props.init_offset?this.currentOffset=this.props.init_offset:this.currentOffset=0,null!=c(this.props.id+"-limit")?this.currentOffset=parseInt(c(this.props.id+"-limit")):null!=this.props.init_limit?this.currentLimit=this.props.init_limit:this.currentLimit=10,null!=this.props.filtered_count&&(this.currentFilteredCount=this.props.filtered_count,this.currentOffset>=this.currentFilteredCount&&this.previous()),null!=this.props.base_count&&(this.currentBaseCount=this.props.base_count,this.currentOffset>=this.currentBaseCount&&this.previous())}},f={methods:{successTransitionHandling:function(e){const t=this;if(null==t.props.success||null==t.props.success.transition||null!=t.props.success.transition.follow_response&&!1!==t.props.success.transition.follow_response||null==t.appNavigateTo)if(null==t.props.success||null==t.props.success.transition||!0!==t.props.success.transition.follow_response||null==t.appNavigateTo)if(null==t.props.success||null==t.props.success.redirect||null!=t.props.success.redirect.follow_response&&!1!==t.props.success.redirect.follow_response)if(null==t.props.success||null==t.props.success.redirect||!0!==t.props.success.redirect.follow_response);else{let t=e.data.redirect_to||e.request.responseURL;window.location.href=t}else{let e=t.props.success.redirect.path;window.location.href=e}else{let r=e.data.transition_to||e.request.responseURL;t.appNavigateTo({url:r,backwards:!1})}else{let e=t.props.success.transition.path;t.appNavigateTo({url:e,backwards:!1})}},failureTransitionHandling:function(e){const t=this;if(null==t.props.failure||null==t.props.failure.transition||null!=t.props.failure.transition.follow_response&&!1!==t.props.failure.transition.follow_response||null==t.appNavigateTo)if(null==t.props.failure||null==t.props.failure.transition||!0!==t.props.failure.transition.follow_response||null==t.appNavigateTo)if(null==t.props.failure||null==t.props.failure.redirect||null!=t.props.failure.redirect.follow_response&&!1!==t.props.failure.redirect.follow_response)if(null==t.props.failure||null==t.props.failure.redirect||!0!==t.props.failure.redirect.follow_response);else{let t=e.response.data.redirect_to||response.request.responseURL;window.location.href=t}else{let e=t.props.failure.redirect.path;window.location.href=e}else{let r=e.response.data.transition_to||response.request.responseURL;t.appNavigateTo({url:r,backwards:!1})}else{let e=t.props.failure.transition.path;t.appNavigateTo({url:e,backwards:!1})}}}},g={mixins:[o,f],template:a.inlineTemplate,data:function(){return{data:{},errors:{},loading:!1,isNestedForm:!1,nestedForms:{},nestedFormRuntimeTemplates:{},nestedFormRuntimeTemplateDomElements:{},deletedNestedForms:{}}},setup:()=>({appNavigateTo:t("appNavigateTo",void 0)}),provide:function(){return{parentFormUid:e((()=>this.props.component_uid)),parentFormData:e((()=>this.data)),parentFormErrors:e((()=>this.errors)),parentFormLoading:e((()=>this.loading)),parentNestedForms:e((()=>this.nestedForms)),parentDeletedNestedForms:e((()=>this.deletedNestedForms)),parentNestedFormRuntimeTemplates:e((()=>this.nestedFormRuntimeTemplates)),parentNestedFormRuntimeTemplateDomElements:e((()=>this.nestedFormRuntimeTemplateDomElements)),parentFormMapToNestedForms:this.mapToNestedForms,parentFormSetErrors:this.setErrors,parentFormResetErrors:this.resetErrors,parentFormIsNestedForm:this.isNestedForm,parentNestedFormRuntimeId:null}},methods:{initDataKey:function(e,t){this.data[e]=t},updateFormValue:function(e,t){this.data[e]=t},hasErrors:function(){for(var e in this.errors)if(null!==this.errors[e]&&""!=this.errors[e])return!0;return!1},resetErrors:function(e){this.errors[e]&&delete this.errors[e]},setErrors:function(e){this.errors=e},setErrorKey:function(e,t){this.errors[e]=t},flushErrors:function(e,t){this.errors={}},setNestedFormsError:function(e){let t=this;Object.keys(e).forEach((function(r){if(r.includes(".")){let s=r.split(".")[1],i=r.split(".")[0].split("[")[0],n=r.split(".")[0].split("[")[1].split("]")[0],o=t.mapToNestedForms(parseInt(n),i+"_attributes");t.nestedForms[i+"_attributes"][o].setNestedFormServerErrorIndex(parseInt(n)),t.nestedForms[i+"_attributes"][o].setErrorKey(s,e[r])}}))},mapToNestedForms:function(e,t){var r;r=null!=this.props.primary_key?this.props.primary_key:"id";for(var s=[],i=0;this.data[t].length>i;){1==this.data[t][i]._destroy&&null==this.data[t][i][r]||s.push(i),i++}return s[e]},resetNestedForms:function(){var e=this;Object.keys(e.nestedForms).forEach((function(t){e.nestedForms[t].forEach((function(e){if(1==e.data._destroy)var t=!0;e.initValues(),t&&(e.hideNestedForm=!0,e.data._destroy=!0)}))}))},initValues:function(){this.emitScopedEvent("init")},shouldResetFormOnSuccessfulSubmit(){const e=this;return null!=e.props.success&&null!=e.props.success.reset?e.props.success.reset:e.shouldResetFormOnSuccessfulSubmitByDefault()},shouldResetFormOnSuccessfulSubmitByDefault(){return"put"!=this.props.method},perform:function(){const e=this;null==e.props.fields_for&&(this.getRefs().form.checkValidity()?(e.loading=!0,null!=e.props.emit&&n.$emit(e.props.emit),null!=e.props.delay?setTimeout((function(){e.sendRequest()}),parseInt(e.props.delay)):e.sendRequest()):n.$emit("static_form_errors"))},transformToFormData:function(e,t,r=null){var s=this;for(let i in t)if(i.endsWith("[]"))for(let n in t[i]){let o=t[i][n];null!=r?e.append(s.props.for+r+"["+i.slice(0,-2)+"][]",o):e.append(s.props.for+"["+i.slice(0,-2)+"][]",o)}else Array.isArray(t[i])?t[i].forEach((function(t,n){if(null!=r){let n=r+"["+i+"][]";e=s.transformToFormData(e,t,n)}else{let r="["+i+"][]";e=s.transformToFormData(e,t,r)}})):null!=t[i]&&(null!=r?e.append(s.props.for+r+"["+i+"]",t[i]):e.append(s.props.for+"["+i+"]",t[i]));return e},sendRequest:function(){const e=this;let t={};t[e.props.for]=e.data;let s={};if(1==e.props.multipart){let t=new FormData;t=this.transformToFormData(t,this.data),s={method:e.props.method,url:e.props.submit_path,data:t,headers:{"X-CSRF-Token":e.getXcsrfToken(),"Content-Type":"multipart/form-data"}}}else s={method:e.props.method,url:e.props.submit_path,data:t,headers:{"X-CSRF-Token":e.getXcsrfToken(),"Content-Type":"application/json"}};r(s).then((function(t){e.loading=!1,null!=e.props.success&&null!=e.props.success.emit&&n.$emit(e.props.success.emit,t.data),e.successTransitionHandling(t),e.flushErrors(),e.shouldResetFormOnSuccessfulSubmit()&&(e.initValues(),e.resetNestedForms())})).catch((function(t){e.loading=!1,t.response&&t.response.data&&t.response.data.errors&&(e.errors=t.response.data.errors,e.setErrors(t.response.data.errors),e.setNestedFormsError(t.response.data.errors)),null!=e.props.failure&&null!=e.props.failure.emit&&n.$emit(e.props.failure.emit,t.response.data),e.failureTransitionHandling(t)}))}},mounted:function(){this.initValues()}},F={mixins:[g],template:a.inlineTemplate,methods:{perform:function(){var e;for(var t in this.data,this.data)null!=this.data[t]&&(e=m(this.props.id+"-filter-"+t,JSON.stringify(this.data[t]),e));e=m(this.props.id+"-offset",0,e),window.history.pushState({matestackApp:!0,url:e},null,e),n.$emit(this.props.id+"-update")},resetFilter:function(){var e;for(var t in this.data)e=m(this.props.id+"-filter-"+t,null,e),this.data[t]=null;this.initValues(),window.history.pushState({matestackApp:!0,url:e},null,e),n.$emit(this.props.id+"-update")}},created:function(){var e=this,t=d();Object.keys(t).forEach((function(r){r.startsWith(e.props.id+"-filter-")&&(e.data[r.replace(e.props.id+"-filter-","")]=JSON.parse(t[r]))}))}},v={mixins:[o],template:a.inlineTemplate,data:function(){return{ordering:{}}},methods:{toggleOrder:function(e){var t;null==this.ordering[e]?this.ordering[e]="asc":"asc"==this.ordering[e]?this.ordering[e]="desc":"desc"==this.ordering[e]&&(this.ordering[e]=void 0),t=m(this.props.id+"-order-"+e,this.ordering[e]),t=m(this.props.id+"-offset",0,t),window.history.pushState({matestackApp:!0,url:t},null,t),n.$emit(this.props.id+"-update"),this.$forceUpdate()},orderIndicator(e,t){return t[this.ordering[e]]}},created:function(){var e=this,t=d();Object.keys(t).forEach((function(r){r.startsWith(e.props.id+"-order-")&&(e.ordering[r.replace(e.props.id+"-order-","")]=t[r])}))}},_={mixins:[o],template:a.inlineTemplate,data:function(){return{showing:!0,hide_after_timeout:null,event:{data:{}}}},methods:{show:function(e){const t=this;!0!==this.showing&&(this.showing=!0,this.event.data=e,null!=this.props.hide_after&&(t.hide_after_timeout=setTimeout((function(){t.hide()}),parseInt(this.props.hide_after))))},hide:function(){this.showing=!1,this.event.data={}}},created:function(){const e=this;null!=this.props.show_on&&(this.showing=!1,this.props.show_on.split(",").forEach((t=>n.$on(t.trim(),e.show))));null!=this.props.hide_on&&this.props.hide_on.split(",").forEach((t=>n.$on(t.trim(),e.hide)));null!=this.props.show_on&&(this.showing=!1),1==this.props.init_show&&(this.showing=!0)},beforeUnmount:function(){const e=this;(clearTimeout(e.hide_after_timeout),n.$off(this.props.show_on,e.show),n.$off(this.props.hide_on,e.hide),null!=this.props.show_on)&&this.props.show_on.split(",").forEach((t=>n.$off(t.trim(),e.show)));null!=this.props.hide_on&&this.props.hide_on.split(",").forEach((t=>n.$off(t.trim(),e.hide)))}},T={mixins:[o],template:a.inlineTemplate,data:function(){return{}},methods:{perform:function(){n.$emit(this.props.emit,this.props.data)}}},E={mixins:[o],template:a.inlineTemplate,data:function(){return{}},inject:["appNavigateTo","currentPathName","setPageLoading","pageLoading"],computed:{isActive(){return this.props.link_path.split("?")[0]===this.currentPathName},isChildActive(){return this.props.link_path.split("?")[0]!==this.currentPathName&&-1!==this.currentPathName.indexOf(this.props.link_path.split("?")[0])}},methods:{navigateTo:function(e){const t=this;n.$emit("page_loading_triggered",e),this.setPageLoading(!0),null!=t.props.delay?setTimeout((function(){t.performNavigation(e)}),parseInt(t.props.delay)):this.performNavigation(e)},performNavigation:function(e){this.appNavigateTo({url:e,backwards:!1})}}},N={mixins:[o],template:a.inlineTemplate,data:function(){return{asyncTemplate:null,showing:!0,loading:!1,hideAfterTimeout:null,event:{data:{}}}},methods:{show:function(e){const t=this;!0!==this.showing&&(this.showing=!0,this.event.data=e,null!=this.props.defer&&(isNaN(this.props.defer)||this.startDefer()),null!=this.props.hide_after&&(t.hideAfterTimeout=setTimeout((function(){t.hide()}),parseInt(this.props.hide_after))))},hide:function(){this.showing=!1,this.event.data={}},startDefer:function(){const e=this;e.loading=!0,setTimeout((function(){e.rerender()}),parseInt(this.props.defer))},rerender:function(){var e=this;e.loading=!0,r({method:"get",url:location.pathname+location.search,headers:{"X-CSRF-Token":e.getXcsrfToken()},params:{component_key:e.props.component_key,component_class:e.props.parent_class}}).then((function(t){var r=document.createElement("div");r.innerHTML=t.data;var s=r.querySelector("#"+e.props.component_key).outerHTML;e.loading=!1,e.asyncTemplate=s})).catch((function(t){n.$emit("async_rerender_error",{id:e.props.component_key})}))}},created:function(){const e=this;e.registerEvents(this.props.show_on,e.show),e.registerEvents(this.props.hide_on,e.hide),e.registerEvents(this.props.rerender_on,e.rerender),null!=this.props.show_on&&(this.showing=!1),null!=this.props.defer&&(isNaN(this.props.defer)||null==this.props.show_on&&this.startDefer()),1==this.props.init_show&&(this.showing=!0)},beforeUnmount:function(){const e=this;clearTimeout(e.hideAfterTimeout),e.removeEvents(this.props.show_on,e.show),e.removeEvents(this.props.hide_on,e.hide),e.removeEvents(this.props.rerender_on,e.rerender)}},I={mixins:[o,f],template:a.inlineTemplate,data:function(){return{}},setup:()=>({appNavigateTo:t("appNavigateTo",void 0)}),methods:{perform:function(){const e=this;(null==e.props.confirm||confirm(e.props.confirm_text))&&(null!=e.props.emit&&n.$emit(e.props.emit),null!=e.props.delay?setTimeout((function(){e.sendRequest()}),parseInt(e.props.delay)):this.sendRequest())},sendRequest:function(){const e=this;r({method:e.props.method,url:e.props.action_path,data:e.props.data,headers:{"X-CSRF-Token":e.getXcsrfToken()}}).then((function(t){null!=e.props.success&&null!=e.props.success.emit&&n.$emit(e.props.success.emit,t.data),e.successTransitionHandling(t)})).catch((function(t){null!=e.props.failure&&null!=e.props.failure.emit&&n.$emit(e.props.failure.emit,t.response.data),e.failureTransitionHandling(t)}))}}},y={mixins:[o],template:a.inlineTemplate,props:{initialTemplate:String},data:function(){return{cableTemplate:null,cableTemplateDomElement:null,loading:!1,event:{data:{}}}},methods:{append:function(e){var t=this.formatPayload(e);this.cableTemplateDomElement.insertAdjacentHTML("beforeend",t.join("")),this.updateCableTemplate()},prepend:function(e){var t=this.formatPayload(e);this.cableTemplateDomElement.insertAdjacentHTML("afterbegin",t.join("")),this.updateCableTemplate()},delete:function(e){this.formatPayload(e).forEach((e=>this.cableTemplateDomElement.querySelector("#"+e).remove())),this.updateCableTemplate()},update:function(e){const t=this;this.formatPayload(e).forEach((function(e){var r=document.createElement("div");r.innerHTML=e.replace(/^\s+|\s+$/g,"");var s=r.firstChild.id,i=t.cableTemplateDomElement.querySelector("#"+s);i.parentNode.replaceChild(r.firstChild,i)})),this.updateCableTemplate()},replace:function(e){var t=this.formatPayload(e);this.cableTemplateDomElement.innerHTML=t.join(""),this.updateCableTemplate()},updateCableTemplate:function(){this.cableTemplate=this.cableTemplateDomElement.outerHTML},formatPayload:function(e){return Array.isArray(e.data)?e.data:[e.data]}},mounted:function(){const e=this;var t=document.createElement("div");t.innerHTML=this.initialTemplate,this.cableTemplateDomElement=t.querySelector("#"+this.props.id),this.cableTemplate=this.cableTemplateDomElement.outerHTML,this.registerEvents(this.props.append_on,e.append),this.registerEvents(this.props.prepend_on,e.prepend),this.registerEvents(this.props.delete_on,e.delete),this.registerEvents(this.props.update_on,e.update),this.registerEvents(this.props.replace_on,e.replace)},beforeUnmount:function(){const e=this;this.cableTemplate=null,this.removeEvents(this.props.append_on,e.append),this.removeEvents(this.props.prepend_on,e.prepend),this.removeEvents(this.props.delete_on,e.delete),this.removeEvents(this.props.update_on,e.update),this.removeEvents(this.props.replace_on,e.replace)}},w={mixins:[o],props:["props","params"],template:a.inlineTemplate,data:function(){return{isolatedTemplate:null,loading:!1,loadingError:!1}},methods:{rerender:function(){var e=this;e.loading=!0,e.loadingError=!1,null!=e.props.rerender_delay?setTimeout((function(){e.renderIsolatedContent()}),parseInt(this.props.rerender_delay)):e.renderIsolatedContent()},renderIsolatedContent:function(){var e=this;e.loading=!0,e.loadingError=!1,r({method:"get",url:location.pathname+location.search,headers:{"X-CSRF-Token":e.getXcsrfToken()},params:{component_class:e.props.component_class,public_options:e.props.public_options}}).then((function(t){e.loading=!1,e.loadingStart=!1,e.loadingEnd=!0,e.isolatedTemplate=t.data})).catch((function(t){e.loadingError=!0,n.$emit("isolate_rerender_error",{class:e.props.component_class})}))},startDefer:function(){const e=this;e.loading=!0,setTimeout((function(){e.renderIsolatedContent()}),parseInt(this.props.defer))}},created:function(){},beforeUnmount:function(){const e=this;null!=this.props.rerender_on&&this.props.rerender_on.split(",").forEach((t=>n.$off(t.trim(),e.renderIsolatedContent)))},mounted:function(){const e=this;void 0===this.props.init_on||null===this.props.init_on?(1==e.props.defer||Number.isInteger(e.props.defer))&&(isNaN(e.props.defer)?e.renderIsolatedContent():e.startDefer()):null!=e.props.defer?isNaN(e.props.defer)||this.props.init_on.split(",").forEach((t=>n.$on(t.trim(),e.startDefer))):this.props.init_on.split(",").forEach((t=>n.$on(t.trim(),e.renderIsolatedContent)));null!=this.props.rerender_on&&this.props.rerender_on.split(",").forEach((t=>n.$on(t.trim(),e.rerender)))}},k={mixins:[o],template:a.inlineTemplate,data:function(){return{data:{},errors:{},isNestedForm:!0,hideNestedForm:!1,nestedFormRuntimeId:"",nestedFormServerErrorIndex:""}},provide:function(){return{parentFormUid:e((()=>this.props.component_uid)),parentFormData:e((()=>this.data)),parentFormErrors:e((()=>this.errors)),parentNestedFormRuntimeId:e((()=>this.nestedFormRuntimeId)),parentFormMapToNestedForms:this.mapToNestedForms,parentFormSetErrors:this.setErrors,parentFormResetErrors:this.resetErrors}},inject:["parentFormData","parentFormErrors","parentNestedForms","parentDeletedNestedForms","parentFormMapToNestedForms"],methods:{initDataKey:function(e,t){this.data[e]=t},updateFormValue:function(e,t){this.data[e]=t},hasErrors:function(){for(var e in this.errors)if(null!==this.errors[e]&&""!=this.errors[e])return!0;return!1},resetErrors:function(e){this.errors[e]&&delete this.errors[e];var t=this.props.fields_for.replace("_attributes","")+"["+this.nestedFormServerErrorIndex+"]."+e;this.parentFormErrors[t]&&delete this.parentFormErrors[t]},setErrors:function(e){this.errors=e},setNestedFormServerErrorIndex:function(e){this.nestedFormServerErrorIndex=e},setErrorKey:function(e,t){this.errors[e]=t},flushErrors:function(e,t){this.errors={}},removeItem:function(){this.data._destroy=!0,this.hideNestedForm=!0;var e=parseInt(this.nestedFormRuntimeId.replace("_"+this.props.fields_for+"_child_",""));this.parentDeletedNestedForms[this.props.fields_for].push(e);var t=this.props.fields_for.replace("_attributes","")+"["+this.nestedFormServerErrorIndex+"].",r=this;Object.keys(r.parentFormErrors).forEach((function(e){0==e.lastIndexOf(t,0)&&delete r.parentFormErrors[e]}))},initValues:function(){this.emitScopedEvent("init")}},mounted:function(){var e=this;this.data={_destroy:!1},null==this.parentFormData[this.props.fields_for]&&(this.parentFormData[this.props.fields_for]=[]),null==this.parentNestedForms[this.props.fields_for]&&(this.parentNestedForms[this.props.fields_for]=[]),null==this.parentDeletedNestedForms[this.props.fields_for]&&(this.parentDeletedNestedForms[this.props.fields_for]=[]);var t=parseInt(e.getTemplateElement().querySelector(".matestack-form-fields-for").id.replace(this.props.fields_for+"_child_",""));isNaN(t)&&(t=this.parentNestedForms[this.props.fields_for].length,this.nestedFormRuntimeId="_"+this.props.fields_for+"_child_"+t,this.getTemplateElement().id=this.props.fields_for+"_child_"+t,this.initValues(),this.parentFormData[this.props.fields_for].push(this.data),this.parentNestedForms[this.props.fields_for].push(this)),isNaN(t)||(this.nestedFormRuntimeId="_"+this.props.fields_for+"_child_"+t,null==this.parentFormData[this.props.fields_for][t]?(this.initValues(),this.parentFormData[this.props.fields_for].push(this.data),this.parentNestedForms[this.props.fields_for].push(this)):(this.data=this.parentFormData[this.props.fields_for][t],1==this.data._destroy&&(this.hideNestedForm=!0),this.parentNestedForms[this.props.fields_for][t]=this,Object.keys(this.parentFormErrors).forEach((function(r){if(r.includes(".")){let s=r.split(".")[1],i=r.split(".")[0].split("[")[0],n=r.split(".")[0].split("[")[1].split("]")[0],o=e.parentFormMapToNestedForms(parseInt(n),i+"_attributes");i+"_attributes"==e.props.fields_for&&o==t&&(e.setNestedFormServerErrorIndex(parseInt(n)),e.setErrorKey(s,e.parentFormErrors[r]))}}))))}},R={mixins:[o],template:a.inlineTemplate,data:function(){return{}},inject:["parentNestedFormRuntimeTemplates","parentNestedFormRuntimeTemplateDomElements","parentNestedForms"],methods:{addItem:function(e){var t=JSON.parse(this.getTemplateElement().querySelector("#prototype-template-for-"+e).dataset[":template"]),r=t.matchAll(/&quot;component_uid&quot;:&quot;(.+?)&quot;/g),s=[];for(const e of r)s.push(e[1]);if(s.forEach((function(e){var r=Math.floor(1e9*Math.random());t=t.replaceAll(e,r)})),document.createElement("div").innerHTML=t,null==this.parentNestedFormRuntimeTemplateDomElements[e]){(i=document.createElement("div")).innerHTML=t,n=null==this.parentNestedForms[e]?0:this.parentNestedForms[e].length,i.querySelector(".matestack-form-fields-for").id=e+"_child_"+n,this.parentNestedFormRuntimeTemplateDomElements[e]=i,this.parentNestedFormRuntimeTemplates[e]=this.parentNestedFormRuntimeTemplateDomElements[e].outerHTML}else{var i;(i=document.createElement("div")).innerHTML=t;var n=this.parentNestedForms[e].length;i.querySelector(".matestack-form-fields-for").id=e+"_child_"+n,this.parentNestedFormRuntimeTemplateDomElements[e].insertAdjacentHTML("beforeend",i.innerHTML),this.parentNestedFormRuntimeTemplates[e]=this.parentNestedFormRuntimeTemplateDomElements[e].outerHTML}}}},b={inject:["parentFormUid","parentFormData","parentFormErrors","parentFormLoading","parentFormIsNestedForm","parentFormResetErrors","parentNestedFormRuntimeId"],methods:{initialize:function(){const e=this;for(let t in e.getRefs()){let r,s;(t.startsWith("select.")||t.startsWith("input."))&&(r=e.getRefs()[t].attributes["init-value"],s=e.getRefs()[t].attributes["value-type"]),t.startsWith("select.")?t.startsWith("select.multiple.")?(e.parentFormData[t.replace("select.multiple.","")]=null,r?(e.setValue(JSON.parse(r.value)),e.afterInitialize(JSON.parse(r.value))):(e.setValue([]),e.afterInitialize([]))):(e.parentFormData[t.replace("select.","")]=null,r?s&&"Integer"==s.value?(e.setValue(parseInt(r.value)),e.afterInitialize(parseInt(r.value))):(e.setValue(r.value),e.afterInitialize(r.value)):(e.setValue(null),e.afterInitialize(null))):(e.parentFormData[t.replace("input.","")]=null,r?("true"===r.value&&(e.setValue(!0),e.afterInitialize(!0)),"false"===r.value&&(e.setValue(!1),e.afterInitialize(!1))):(e.setValue(null),e.afterInitialize(null)))}},inputChanged:function(e){this.parentFormIsNestedForm&&(this.parentFormData._destroy=!1),this.parentFormResetErrors(e)},afterInitialize:function(e){},setValue:function(e){this.parentFormData[this.props.key]=e}},mounted:function(){this.registerScopedEvent("init",this.initialize,this.parentFormUid)},beforeUnmount:function(){this.removeScopedEvent("init",this.initialize,this.parentFormUid)}},S={mixins:[o,b],template:a.inlineTemplate,data:()=>({})},D={inject:["parentFormUid","parentFormData","parentFormErrors","parentFormLoading","parentFormIsNestedForm","parentFormResetErrors","parentNestedFormRuntimeId"],methods:{initialize:function(){const e=this;for(let t in e.getRefs())if(t.startsWith("input.")){let r=e.getRefs()[t].attributes["init-value"];e.parentFormData[t.replace("input.","")]=null,r?(e.setValue(r.value),e.afterInitialize(r.value)):(e.setValue(null),e.afterInitialize(null))}},filesAdded:function(e){const t=(event.dataTransfer||event.target).files;if(event.target.attributes.multiple){this.parentFormData[e]=[];for(let r in t)t[r]instanceof File&&this.parentFormData[e].push(t[r])}else this.parentFormData[e]=t[0]},inputChanged:function(e){this.parentFormIsNestedForm&&(this.parentFormData._destroy=!1),this.parentFormResetErrors(e)},afterInitialize:function(e){},setValue:function(e){this.getRefs()["input."+this.props.key]&&(this.getRefs()["input."+this.props.key].value=e),this.getRefs()["input."+this.props.key+"[]"]&&(this.getRefs()["input."+this.props.key+"[]"].value=e),this.parentFormData[this.props.key]=e}},mounted:function(){this.registerScopedEvent("init",this.initialize,this.parentFormUid)},beforeUnmount:function(){this.removeScopedEvent("init",this.initialize,this.parentFormUid)}},$={mixins:[o,D],template:a.inlineTemplate,data:()=>({})},C={inject:["parentFormUid","parentFormData","parentFormErrors","parentFormLoading","parentFormIsNestedForm","parentFormResetErrors","parentNestedFormRuntimeId"],methods:{initialize:function(){const e=this;for(let t in e.getRefs()){let r,s;t.startsWith("select.")&&(r=e.getRefs()[t].attributes["init-value"],s=e.getRefs()[t].attributes["value-type"]),t.startsWith("select.")&&(t.startsWith("select.multiple.")?(e.parentFormData[t.replace("select.multiple.","")]=null,r?(e.setValue(JSON.parse(r.value)),e.afterInitialize(JSON.parse(r.value))):(e.setValue([]),e.afterInitialize([]))):(e.parentFormData[t.replace("select.","")]=null,r?s&&"Integer"==s.value?(e.setValue(parseInt(r.value)),e.afterInitialize(parseInt(r.value))):(e.setValue(r.value),e.afterInitialize(r.value)):(e.setValue(null),e.afterInitialize(null))))}},inputChanged:function(e){this.parentFormIsNestedForm&&(this.parentFormData._destroy=!1),this.parentFormResetErrors(e)},afterInitialize:function(e){},setValue:function(e){this.parentFormData[this.props.key]=e}},mounted:function(){this.registerScopedEvent("init",this.initialize,this.parentFormUid)},beforeUnmount:function(){this.removeScopedEvent("init",this.initialize,this.parentFormUid)}},L={mixins:[o,C],template:a.inlineTemplate,data:()=>({})},O={inject:["parentFormUid","parentFormData","parentFormErrors","parentFormLoading","parentFormIsNestedForm","parentFormResetErrors","parentNestedFormRuntimeId"],methods:{initialize:function(){const e=this;for(let t in e.getRefs()){let r,s;t.startsWith("select.")&&(r=e.getRefs()[t].attributes["init-value"],s=e.getRefs()[t].attributes["value-type"]),t.startsWith("select.")&&(t.startsWith("select.multiple.")?(e.parentFormData[t.replace("select.multiple.","")]=null,r?(e.setValue(JSON.parse(r.value)),e.afterInitialize(JSON.parse(r.value))):(e.setValue([]),e.afterInitialize([]))):(e.parentFormData[t.replace("select.","")]=null,r?s&&"Integer"==s.value?(e.setValue(parseInt(r.value)),e.afterInitialize(parseInt(r.value))):(e.setValue(r.value),e.afterInitialize(r.value)):(e.setValue(null),e.afterInitialize(null))))}},inputChanged:function(e){this.parentFormIsNestedForm&&(this.parentFormData._destroy=!1),this.parentFormResetErrors(e)},afterInitialize:function(e){},setValue:function(e){this.parentFormData[this.props.key]=e}},mounted:function(){this.registerScopedEvent("init",this.initialize,this.parentFormUid)},beforeUnmount:function(){this.removeScopedEvent("init",this.initialize,this.parentFormUid)}},x={mixins:[o,O],template:a.inlineTemplate,data:()=>({})},z={inject:["parentFormUid","parentFormData","parentFormErrors","parentFormLoading","parentFormIsNestedForm","parentFormResetErrors","parentNestedFormRuntimeId"],methods:{initialize:function(){const e=this;for(let t in this.getRefs())if(t.startsWith("input.")){let r=e.getRefs()[t].attributes["init-value"];e.parentFormData[t.replace("input.","")]=null,r?(e.setValue(r.value),e.afterInitialize(r.value)):(e.setValue(null),e.afterInitialize(null))}},inputChanged:function(e){this.parentFormIsNestedForm&&(this.parentFormData._destroy=!1),this.parentFormResetErrors(e)},afterInitialize:function(e){},setValue:function(e){this.parentFormData[this.props.key]=e}},mounted:function(){this.registerScopedEvent("init",this.initialize,this.parentFormUid)},beforeUnmount:function(){this.removeScopedEvent("init",this.initialize,this.parentFormUid)}},V={mixins:[o,z],template:a.inlineTemplate,data:()=>({})},U=function(e){return e.config.compilerOptions.whitespace="preserve",e.config.compilerOptions.isCustomElement=e=>"matestack-component-template"===e,e.config.unwrapInjectedRef=!0,e.component("matestack-ui-core-runtime-render",u),e.component("matestack-ui-core-app",p),e.component("matestack-ui-core-page-switch",l),e.component("matestack-ui-core-collection-content",h),e.component("matestack-ui-core-collection-filter",F),e.component("matestack-ui-core-collection-order",v),e.component("matestack-ui-core-toggle",_),e.component("matestack-ui-core-onclick",T),e.component("matestack-ui-core-transition",E),e.component("matestack-ui-core-async",N),e.component("matestack-ui-core-action",I),e.component("matestack-ui-core-cable",y),e.component("matestack-ui-core-isolate",w),e.component("matestack-ui-core-form",g),e.component("matestack-ui-core-form-checkbox",S),e.component("matestack-ui-core-form-input",$),e.component("matestack-ui-core-form-radio",L),e.component("matestack-ui-core-form-select",x),e.component("matestack-ui-core-form-textarea",V),e.component("matestack-ui-core-form-nested-form",k),e.component("matestack-ui-core-form-fields-for-add-item",R),e},A={eventHub:n,matestackEventHub:n,componentMixin:o,componentHelpers:a,formInputMixin:D,formSelectMixin:O,formCheckboxMixin:b,formTextareaMixin:z,formRadioMixin:C,registerComponents:U,mount:function(e,t="#matestack-ui"){return U(e),e.mount(t),e}};export{A as default};
